{% extends "layout.html" %}

{% block title %}- Feature Importance{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title">
                    <i class="fas fa-chart-bar text-primary"></i> Feature Importance
                </h2>
                <p class="card-text lead">Analyzing the impact of each feature on housing price predictions</p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <!-- Feature Importance Plot Card -->
    <div class="col-md-6">
        <div class="card shadow h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Feature Importance Plot</h5>
            </div>
            <div class="card-body">
                <div id="importance-plot" class="plot-container" style="height: 500px;"></div>
            </div>
        </div>
    </div>
    
    <!-- Feature Rankings Card -->
    <div class="col-md-6">
        <div class="card shadow h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-list-ol"></i> Feature Rankings</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Feature</th>
                                <th>Importance Score</th>
                                <th>Relative Importance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for feature in importance_results.importance_data %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ feature.feature }}</td>
                                <td>{{ feature.importance|round(4) }}</td>
                                <td>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" 
                                            style="width: {{ (feature.importance / importance_results.importance_data[0].importance * 100)|round(1) }}%;" 
                                            aria-valuenow="{{ (feature.importance / importance_results.importance_data[0].importance * 100)|round(1) }}" 
                                            aria-valuemin="0" 
                                            aria-valuemax="100">
                                            {{ (feature.importance / importance_results.importance_data[0].importance * 100)|round(1) }}%
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-lightbulb"></i> Interpreting Feature Importance</h5>
            </div>
            <div class="card-body">
                <p>Feature importance in Random Forest models indicates how useful or valuable each feature was in the construction of the boosted decision trees. The more a feature is used to make key decisions, the higher its importance.</p>
                
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle"></i> Insights:</h5>
                    <ul>
                        <li>Typically, <strong>median_income</strong> is one of the strongest predictors of housing prices in California.</li>
                        <li>Geographic features (<strong>latitude</strong> and <strong>longitude</strong>) often have high importance, reflecting location's impact on real estate values.</li>
                        <li>Engineered features like <strong>rooms_per_household</strong> and <strong>distance_to_ocean</strong> may capture important relationships not present in the original features.</li>
                    </ul>
                </div>
                
                <div class="text-center mt-4">
                    <a href="/shap-analysis" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i> Explore SHAP Analysis
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Load importance plot
        fetch('/api/importance-plot')
            .then(response => response.json())
            .then(plotData => {
                Plotly.newPlot('importance-plot', plotData.data, plotData.layout);
            })
            .catch(error => console.error('Error loading importance plot:', error));
            
        // Animate progress bars
        document.querySelectorAll('.progress-bar').forEach(bar => {
            const value = parseFloat(bar.style.width);
            bar.style.width = '0%';
            setTimeout(() => {
                bar.style.width = value + '%';
            }, 300);
        });
    });

    // Make plots responsive
    window.addEventListener('resize', function() {
        Plotly.relayout('importance-plot', {
            autosize: true
        });
    });
</script>
{% endblock %}
